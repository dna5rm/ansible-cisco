#!/bin/env -S ansible-playbook -i inventory
---
- name: manage ios host
  hosts: all
  gather_facts: false

  pre_tasks:

    - name: Fail if not ios
      ansible.builtin.fail:
      no_log: true
      when: ansible_network_os != "cisco.ios.ios"

    - name: Gather all legacy facts
      connection: ansible.netcommon.network_cli
      cisco.ios.ios_facts:
        gather_subset: all

  tasks:

    - name: configure hostname and domain name
      cisco.ios.ios_system:
        hostname: "{{ inventory_hostname }}"
        domain_name: "{{ global.domain_name | default('local') }}"
        name_servers: "{{ global.name_servers | default('1.1.1.3') }}"
        state: present
      when: global is defined

    - name: configure the login banner
      cisco.ios.ios_banner:
        banner: login
        text: "{{ global.banner.login }}"
        state: present
      when:
        - global is defined
        - global.banner is defined
        - global.banner.login is defined

    - name: configure the motd banner
      cisco.ios.ios_banner:
        banner: motd
        text: "{{ global.banner.motd }}"
        state: present
      when:
        - global is defined
        - global.banner is defined
        - global.banner.motd is defined
